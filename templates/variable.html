<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/css/style.css"/>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<title>$$$VARIABLE$$$</title>
	<style>
		body { font-family: Arial, Helvetica, sans-serif; padding: 1rem; }
		header { display:flex; justify-content:space-between; align-items:center; }
		table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
		th, td { border: 1px solid #ddd; padding: 8px; }
		th { background: #f4f4f4; text-align: left; }
		tr:nth-child(even) { background: #fafafa; }
		.muted { color: #666; font-size: 0.9rem; }
	</style>
</head>
<body>
	<div class="container">
		<div class="layout">
			<aside class="sidebar">
				<h2>Navigation</h2>
				<ul class="menu">
					<li><a href="/">Home</a></li>
					<li><a href="/display.html?type=countries">Filter by Area</a></li>
					<li><a href="/display.html?type=variables">Filter by Variable</a></li>
					<li><a href="/display.html?type=years">Filter by Year</a></li>
				</ul>
			</aside>
			<main class="content">
				<h1>$$$VARIABLE$$$</h1>
				$$$VARIABLE_NAV$$$
				<p class="muted">Showing data rows for the selected variable.</p>
				
				<div style="width: 100%; height: 300px; margin: 20px 0;">
					<canvas id="myChart"></canvas>
				</div>
				
				<table id="dataTable">
					<thead>
						<tr>
							<th>Area</th>
							<th>Year</th>
							<th>$$$VARIABLE$$$</th>
						</tr>
					</thead>
					<tbody>
						$$$DATA_ROWS$$$
					</tbody>
				</table>
				
				<script>
					// Extract data from the table and create chart
					window.addEventListener('load', function() {
						const table = document.getElementById('dataTable');
						const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
						
						const dataMap = {};
						
						// Group data by area and get the latest value
						for (let i = 0; i < rows.length; i++) {
							const cells = rows[i].getElementsByTagName('td');
							const area = cells[0].textContent;
							const year = parseInt(cells[1].textContent);
							const value = parseFloat(cells[2].textContent);
							
							if (!dataMap[area] || year > dataMap[area].year) {
								dataMap[area] = { value: value, year: year };
							}
						}
						
						// Create arrays for chart
						const labels = Object.keys(dataMap);
						const data = labels.map(area => dataMap[area].value);
						
						// Create different colors for each bar
						const colors = [
							'rgba(255, 99, 132, 0.7)',   // Red
							'rgba(54, 162, 235, 0.7)',   // Blue
							'rgba(255, 205, 86, 0.7)',   // Yellow
							'rgba(75, 192, 192, 0.7)',   // Teal
							'rgba(153, 102, 255, 0.7)',  // Purple
						];
						
					
						// Create the chart
						const ctx = document.getElementById('myChart').getContext('2d');
						const chart = new Chart(ctx, {
							type: 'bar',
							data: {
								labels: labels,
								datasets: [{
									label: document.querySelector('h1').textContent,
									data: data,
									backgroundColor: colors.slice(0, labels.length),
									borderWidth: 1
								}]
							},
						});
					});
				</script>
			</main>
		</div>
	</div>
</body>
</html>
